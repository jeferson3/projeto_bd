-- phpMyAdmin SQL Dump
-- version 5.1.3
-- https://www.phpmyadmin.net/
--
-- Host: localhost
-- Tempo de geração: 19-Jun-2022 às 01:02
-- Versão do servidor: 10.4.24-MariaDB
-- versão do PHP: 8.1.4

SET SQL_MODE = "NO_AUTO_VALUE_ON_ZERO";
START TRANSACTION;
SET time_zone = "+00:00";


/*!40101 SET @OLD_CHARACTER_SET_CLIENT=@@CHARACTER_SET_CLIENT */;
/*!40101 SET @OLD_CHARACTER_SET_RESULTS=@@CHARACTER_SET_RESULTS */;
/*!40101 SET @OLD_COLLATION_CONNECTION=@@COLLATION_CONNECTION */;
/*!40101 SET NAMES utf8mb4 */;

--
-- Banco de dados: `projeto_bd`
--

DELIMITER $$
--
-- Procedimentos
--
CREATE DEFINER=`root`@`localhost` PROCEDURE `atualizar_aluno` (IN `id` INT, IN `nome` VARCHAR(150), IN `data_nascimento` DATE, IN `telefone` VARCHAR(150), IN `email` VARCHAR(150))   BEGIN
	UPDATE alunos a SET a.data_nascimento=data_nascimento, a.nome=nome, a.telefone=telefone, a.email=email where a.id=id; 
END$$

CREATE DEFINER=`root`@`localhost` PROCEDURE `atualizar_aluno_disciplina` (IN `aluno_id` INT, IN `disciplina_id` INT, IN `status` VARCHAR(50), IN `frequencia` FLOAT, IN `nota_bimestre1` FLOAT, IN `nota_bimestre2` FLOAT)   BEGIN
	UPDATE aluno_disciplina ad SET ad.status=status, ad.frequencia=frequencia, ad.nota_bimestre1=nota_bimestre1, ad.nota_bimestre2=nota_bimestre2 where ad.aluno_id=aluno_id AND ad.disciplina_id=disciplina_id; 
END$$

CREATE DEFINER=`root`@`localhost` PROCEDURE `atualizar_curso` (IN `id` INT, IN `nome` VARCHAR(150), IN `tipo` VARCHAR(150))   BEGIN
	UPDATE cursos c SET c.nome=nome, c.tipo=tipo where c.id=id; 
END$$

CREATE DEFINER=`root`@`localhost` PROCEDURE `atualizar_curso_disciplina` (IN `curso_id` INT, IN `disciplina_id` INT, IN `carga_horaria` INT)   BEGIN
	UPDATE curso_disciplina cd SET cd.carga_horaria=carga_horaria where cd.curso_id=curso_id AND cd.disciplina_id=disciplina_id; 
END$$

CREATE DEFINER=`root`@`localhost` PROCEDURE `atualizar_disciplina` (IN `id` INT, IN `nome` VARCHAR(150), IN `pre_requisito_id` INT)   BEGIN
	UPDATE disciplinas d SET d.nome=nome, d.pre_requisito_id=pre_requisito_id where d.id=id; 
END$$

CREATE DEFINER=`root`@`localhost` PROCEDURE `atualizar_professor` (IN `id` INT, IN `nome` VARCHAR(150), IN `telefone` VARCHAR(20))   BEGIN
	UPDATE professores p SET p.nome=nome, p.telefone=telefone where p.id=id; 
END$$

CREATE DEFINER=`root`@`localhost` PROCEDURE `atualizar_senha_aluno` (IN `id` INT, IN `senha` VARCHAR(150))   BEGIN
	UPDATE alunos a SET a.senha=senha where a.id=id; 
END$$

CREATE DEFINER=`root`@`localhost` PROCEDURE `atualizar_senha_professor` (IN `id` INT, IN `senha` VARCHAR(150))   BEGIN
	UPDATE professores p SET p.senha=senha where p.id=id; 
END$$

CREATE DEFINER=`root`@`localhost` PROCEDURE `cadastrar_aluno` (IN `nome` VARCHAR(150), IN `data_nascimento` DATE, IN `cpf` VARCHAR(50), IN `rg` VARCHAR(20), IN `telefone` VARCHAR(150), IN `curso_id` INT, IN `email` VARCHAR(150), IN `senha` VARCHAR(150))   BEGIN
	INSERT into alunos(data_nascimento, nome, cpf, rg, telefone, curso_id, email, senha) 				VALUES(data_nascimento, nome, cpf, rg, telefone, curso_id, email, senha); 
END$$

CREATE DEFINER=`root`@`localhost` PROCEDURE `cadastrar_aluno_disciplina` (IN `aluno_id` INT, IN `disciplina_id` INT, IN `status` VARCHAR(50), IN `frequencia` FLOAT)   BEGIN
	INSERT into aluno_disciplina(aluno_id, disciplina_id, status, frequencia) 
    VALUES(aluno_id, disciplina_id, status, frequencia); 
END$$

CREATE DEFINER=`root`@`localhost` PROCEDURE `cadastrar_curso` (IN `nome` VARCHAR(150), IN `tipo` VARCHAR(150))   BEGIN
	INSERT into cursos(nome, tipo) VALUES(nome, tipo); 
END$$

CREATE DEFINER=`root`@`localhost` PROCEDURE `cadastrar_curso_disciplina` (IN `curso_id` INT, IN `disciplina_id` INT, IN `carga_horaria` INT)   BEGIN
	INSERT into curso_disciplina(curso_id, disciplina_id, carga_horaria) 
    VALUES(curso_id, disciplina_id, carga_horaria); 
END$$

CREATE DEFINER=`root`@`localhost` PROCEDURE `cadastrar_disciplina` (IN `nome` VARCHAR(150), IN `pre_requisito_id` INT)   BEGIN
	INSERT into disciplinas(nome, pre_requisito_id) VALUES(nome, pre_requisito_id); 
END$$

CREATE DEFINER=`root`@`localhost` PROCEDURE `cadastrar_professor` (IN `nome` VARCHAR(150), IN `cpf` VARCHAR(50), IN `telefone` VARCHAR(20), IN `email` VARCHAR(100), IN `senha` VARCHAR(500))   BEGIN
	INSERT into professores(nome, cpf, telefone, email, senha) 
    VALUES(nome, cpf, telefone, email, senha); 
END$$

CREATE DEFINER=`root`@`localhost` PROCEDURE `cadastrar_professor_disciplina` (IN `professor_id` INT, IN `disciplina_id` INT)   BEGIN
	INSERT into professor_disciplina(professor_id, disciplina_id) 
    VALUES(professor_id, disciplina_id); 
END$$

CREATE DEFINER=`root`@`localhost` PROCEDURE `deletar_aluno_pelo_id` (IN `id` INT)   BEGIN
	DELETE from alunos where id=id; 
END$$

CREATE DEFINER=`root`@`localhost` PROCEDURE `deletar_curso_pelo_id` (IN `id` INT)   BEGIN
	DELETE from cursos where id=id; 
END$$

--
-- Funções
--
CREATE DEFINER=`root`@`localhost` FUNCTION `media_aluno_disciplina` (`nota_bimestre1` FLOAT, `nota_bimestre2` FLOAT) RETURNS FLOAT DETERMINISTIC BEGIN

RETURN ((nota_bimestre1 + nota_bimestre2) / 2);

END$$

DELIMITER ;

-- --------------------------------------------------------

--
-- Estrutura da tabela `admins`
--

CREATE TABLE `admins` (
  `id` int(11) NOT NULL,
  `nome` varchar(255) NOT NULL,
  `email` varchar(255) NOT NULL,
  `senha` varchar(500) NOT NULL
) ENGINE=InnoDB DEFAULT CHARSET=utf8mb4;

--
-- Extraindo dados da tabela `admins`
--

INSERT INTO `admins` (`id`, `nome`, `email`, `senha`) VALUES
(1, 'admin 1', 'email@email.com', '$2y$10$bu84FV2H9Db2D3o2DoVHy.mna1vfah1V5.OuF6DZNLCk79cORdVae');

-- --------------------------------------------------------

--
-- Estrutura da tabela `alunos`
--

CREATE TABLE `alunos` (
  `id` int(11) NOT NULL,
  `data_nascimento` date NOT NULL,
  `nome` varchar(155) NOT NULL,
  `cpf` varchar(20) NOT NULL,
  `rg` varchar(20) NOT NULL,
  `telefone` varchar(20) NOT NULL,
  `curso_id` int(11) NOT NULL,
  `email` varchar(155) NOT NULL,
  `senha` varchar(500) NOT NULL
) ENGINE=InnoDB DEFAULT CHARSET=utf8mb4;

--
-- Extraindo dados da tabela `alunos`
--

INSERT INTO `alunos` (`id`, `data_nascimento`, `nome`, `cpf`, `rg`, `telefone`, `curso_id`, `email`, `senha`) VALUES
(1, '1998-01-01', 'nome 1', '12212332566', '6666555', '87988363925', 1, 'joao@email.com', '234556'),
(2, '1998-03-12', 'nome 2', '12332145699', '1234567', '87988666544', 1, 'email@email.com', '$2y$10$bu84FV2H9Db2D3o2DoVHy.mna1vfah1V5.OuF6DZNLCk79cORdVae'),
(3, '1998-03-12', 'nome 3 edited', '12332145698', '1234568', '87988666544', 1, 'email3@email.com', '$2y$10$bu84FV2H9Db2D3o2DoVHy.mna1vfah1V5.OuF6DZNLCk79cORdVae'),
(7, '2022-06-23', 'teste da silva edited', '12365498741', '123456', '87988363925', 2, 'teste@email', '$2y$10$AWkGmT.vNJYtfVjqb8hYg.zcBXeyF.PhZrSXG9DMFxgplEIpMgrqy'),
(8, '1998-03-12', 'aluno teste', '32165498785', '65498720', '87988888888', 3, 'aluno_teste@email.com', '$2y$10$TJmiLO3HEsr9qCJr6Hj1HO1Rj7UiW4yQxJYkZ.puH/69TC9/KW8d2');

-- --------------------------------------------------------

--
-- Estrutura da tabela `aluno_disciplina`
--

CREATE TABLE `aluno_disciplina` (
  `aluno_id` int(11) NOT NULL,
  `disciplina_id` int(11) NOT NULL,
  `status` enum('cursando','aprovado','reprovado','trancado') NOT NULL DEFAULT 'cursando',
  `frequencia` decimal(10,2) NOT NULL,
  `nota_bimestre1` decimal(10,2) DEFAULT NULL,
  `nota_bimestre2` decimal(10,2) DEFAULT NULL
) ENGINE=InnoDB DEFAULT CHARSET=utf8mb4;

--
-- Extraindo dados da tabela `aluno_disciplina`
--

INSERT INTO `aluno_disciplina` (`aluno_id`, `disciplina_id`, `status`, `frequencia`, `nota_bimestre1`, `nota_bimestre2`) VALUES
(1, 1, 'cursando', '54.20', '7.00', '6.00'),
(2, 1, 'reprovado', '100.00', '6.00', '8.00'),
(3, 1, 'aprovado', '100.00', '7.00', '9.00');

-- --------------------------------------------------------

--
-- Estrutura stand-in para vista `aluno_disciplina_view`
-- (Veja abaixo para a view atual)
--
CREATE TABLE `aluno_disciplina_view` (
`id` int(11)
,`data_nascimento` date
,`nome` varchar(155)
,`cpf` varchar(20)
,`rg` varchar(20)
,`telefone` varchar(20)
,`curso_id` int(11)
,`email` varchar(155)
,`senha` varchar(500)
,`disciplina_pk_id` int(11)
,`disciplina_nome` varchar(150)
,`pre_requisito_id` int(11)
,`aluno_id` int(11)
,`disciplina_id` int(11)
,`status` enum('cursando','aprovado','reprovado','trancado')
,`frequencia` decimal(10,2)
,`nota_bimestre1` decimal(10,2)
,`nota_bimestre2` decimal(10,2)
);

-- --------------------------------------------------------

--
-- Estrutura da tabela `cursos`
--

CREATE TABLE `cursos` (
  `id` int(11) NOT NULL,
  `nome` varchar(150) NOT NULL,
  `tipo` enum('licenciatura','bacharelado','tecnico') NOT NULL
) ENGINE=InnoDB DEFAULT CHARSET=utf8mb4;

--
-- Extraindo dados da tabela `cursos`
--

INSERT INTO `cursos` (`id`, `nome`, `tipo`) VALUES
(1, 'curso atualizado', 'licenciatura'),
(2, 'curso atualizado 2', 'licenciatura'),
(3, 'teste 2 edited', 'bacharelado');

-- --------------------------------------------------------

--
-- Estrutura da tabela `curso_disciplina`
--

CREATE TABLE `curso_disciplina` (
  `curso_id` int(11) NOT NULL,
  `disciplina_id` int(11) NOT NULL,
  `carga_horaria` int(11) NOT NULL
) ENGINE=InnoDB DEFAULT CHARSET=utf8mb4;

--
-- Extraindo dados da tabela `curso_disciplina`
--

INSERT INTO `curso_disciplina` (`curso_id`, `disciplina_id`, `carga_horaria`) VALUES
(1, 1, 200),
(2, 2, 60);

-- --------------------------------------------------------

--
-- Estrutura stand-in para vista `curso_disciplina_view`
-- (Veja abaixo para a view atual)
--
CREATE TABLE `curso_disciplina_view` (
`id` int(11)
,`nome` varchar(150)
,`tipo` enum('licenciatura','bacharelado','tecnico')
,`disciplina_pk_id` int(11)
,`disciplina_nome` varchar(150)
,`pre_requisito_id` int(11)
);

-- --------------------------------------------------------

--
-- Estrutura da tabela `disciplinas`
--

CREATE TABLE `disciplinas` (
  `id` int(11) NOT NULL,
  `nome` varchar(150) NOT NULL,
  `pre_requisito_id` int(11) DEFAULT NULL
) ENGINE=InnoDB DEFAULT CHARSET=utf8mb4;

--
-- Extraindo dados da tabela `disciplinas`
--

INSERT INTO `disciplinas` (`id`, `nome`, `pre_requisito_id`) VALUES
(1, 'displicna 1r edited', 2),
(2, 'nome', 1),
(3, 'nome 2', 3),
(4, 'teste da silva edited', 2);

-- --------------------------------------------------------

--
-- Estrutura da tabela `professores`
--

CREATE TABLE `professores` (
  `id` int(11) NOT NULL,
  `nome` varchar(150) NOT NULL,
  `cpf` varchar(20) NOT NULL,
  `telefone` varchar(20) NOT NULL,
  `email` varchar(150) NOT NULL,
  `senha` varchar(500) NOT NULL
) ENGINE=InnoDB DEFAULT CHARSET=utf8mb4;

--
-- Extraindo dados da tabela `professores`
--

INSERT INTO `professores` (`id`, `nome`, `cpf`, `telefone`, `email`, `senha`) VALUES
(1, 'professor att', '32165498755', '8798888888', 'jose@email.com', '12345'),
(2, 'nome', '12345642311', '87988556633', 'email@email.com', '$2y$10$bu84FV2H9Db2D3o2DoVHy.mna1vfah1V5.OuF6DZNLCk79cORdVae'),
(4, 'professor edited', '6549875236', '87988888888', 'prof_teste@email', '$2y$10$GiooJ4xrwrG1ZipfP.5c3uKJ2X54ArITwnPp6zrrERr20O8/x84bS');

-- --------------------------------------------------------

--
-- Estrutura da tabela `professor_disciplina`
--

CREATE TABLE `professor_disciplina` (
  `disciplina_id` int(11) NOT NULL,
  `professor_id` int(11) NOT NULL
) ENGINE=InnoDB DEFAULT CHARSET=utf8mb4;

--
-- Extraindo dados da tabela `professor_disciplina`
--

INSERT INTO `professor_disciplina` (`disciplina_id`, `professor_id`) VALUES
(1, 1),
(2, 1),
(1, 2),
(2, 2);

-- --------------------------------------------------------

--
-- Estrutura stand-in para vista `professor_disciplina_view`
-- (Veja abaixo para a view atual)
--
CREATE TABLE `professor_disciplina_view` (
`id` int(11)
,`nome` varchar(150)
,`cpf` varchar(20)
,`telefone` varchar(20)
,`email` varchar(150)
,`senha` varchar(500)
,`disciplina_pk_id` int(11)
,`disciplina_nome` varchar(150)
,`pre_requisito_id` int(11)
,`disciplina_id` int(11)
,`professor_id` int(11)
);

-- --------------------------------------------------------

--
-- Estrutura para vista `aluno_disciplina_view`
--
DROP TABLE IF EXISTS `aluno_disciplina_view`;

CREATE ALGORITHM=UNDEFINED DEFINER=`root`@`localhost` SQL SECURITY DEFINER VIEW `aluno_disciplina_view`  AS SELECT `a`.`id` AS `id`, `a`.`data_nascimento` AS `data_nascimento`, `a`.`nome` AS `nome`, `a`.`cpf` AS `cpf`, `a`.`rg` AS `rg`, `a`.`telefone` AS `telefone`, `a`.`curso_id` AS `curso_id`, `a`.`email` AS `email`, `a`.`senha` AS `senha`, `d`.`id` AS `disciplina_pk_id`, `d`.`nome` AS `disciplina_nome`, `d`.`pre_requisito_id` AS `pre_requisito_id`, `ad`.`aluno_id` AS `aluno_id`, `ad`.`disciplina_id` AS `disciplina_id`, `ad`.`status` AS `status`, `ad`.`frequencia` AS `frequencia`, `ad`.`nota_bimestre1` AS `nota_bimestre1`, `ad`.`nota_bimestre2` AS `nota_bimestre2` FROM ((`aluno_disciplina` `ad` join `alunos` `a` on(`ad`.`aluno_id` = `a`.`id`)) join `disciplinas` `d` on(`ad`.`disciplina_id` = `d`.`id`))  ;

-- --------------------------------------------------------

--
-- Estrutura para vista `curso_disciplina_view`
--
DROP TABLE IF EXISTS `curso_disciplina_view`;

CREATE ALGORITHM=UNDEFINED DEFINER=`root`@`localhost` SQL SECURITY DEFINER VIEW `curso_disciplina_view`  AS SELECT `c`.`id` AS `id`, `c`.`nome` AS `nome`, `c`.`tipo` AS `tipo`, `d`.`id` AS `disciplina_pk_id`, `d`.`nome` AS `disciplina_nome`, `d`.`pre_requisito_id` AS `pre_requisito_id` FROM ((`curso_disciplina` `cd` join `cursos` `c` on(`cd`.`curso_id` = `c`.`id`)) join `disciplinas` `d` on(`cd`.`disciplina_id` = `d`.`id`))  ;

-- --------------------------------------------------------

--
-- Estrutura para vista `professor_disciplina_view`
--
DROP TABLE IF EXISTS `professor_disciplina_view`;

CREATE ALGORITHM=UNDEFINED DEFINER=`root`@`localhost` SQL SECURITY DEFINER VIEW `professor_disciplina_view`  AS SELECT `p`.`id` AS `id`, `p`.`nome` AS `nome`, `p`.`cpf` AS `cpf`, `p`.`telefone` AS `telefone`, `p`.`email` AS `email`, `p`.`senha` AS `senha`, `d`.`id` AS `disciplina_pk_id`, `d`.`nome` AS `disciplina_nome`, `d`.`pre_requisito_id` AS `pre_requisito_id`, `pd`.`disciplina_id` AS `disciplina_id`, `pd`.`professor_id` AS `professor_id` FROM ((`professor_disciplina` `pd` join `professores` `p` on(`pd`.`professor_id` = `p`.`id`)) join `disciplinas` `d` on(`pd`.`disciplina_id` = `d`.`id`))  ;

--
-- Índices para tabelas despejadas
--

--
-- Índices para tabela `admins`
--
ALTER TABLE `admins`
  ADD PRIMARY KEY (`id`),
  ADD UNIQUE KEY `email_unique` (`email`);

--
-- Índices para tabela `alunos`
--
ALTER TABLE `alunos`
  ADD PRIMARY KEY (`id`),
  ADD UNIQUE KEY `cpf` (`cpf`),
  ADD UNIQUE KEY `rg` (`rg`),
  ADD UNIQUE KEY `email` (`email`),
  ADD KEY `curso_id` (`curso_id`);

--
-- Índices para tabela `aluno_disciplina`
--
ALTER TABLE `aluno_disciplina`
  ADD PRIMARY KEY (`aluno_id`,`disciplina_id`),
  ADD KEY `disciplina_id` (`disciplina_id`);

--
-- Índices para tabela `cursos`
--
ALTER TABLE `cursos`
  ADD PRIMARY KEY (`id`);

--
-- Índices para tabela `curso_disciplina`
--
ALTER TABLE `curso_disciplina`
  ADD PRIMARY KEY (`curso_id`,`disciplina_id`),
  ADD KEY `disciplina_id` (`disciplina_id`);

--
-- Índices para tabela `disciplinas`
--
ALTER TABLE `disciplinas`
  ADD PRIMARY KEY (`id`),
  ADD KEY `pre_requisito_id` (`pre_requisito_id`);

--
-- Índices para tabela `professores`
--
ALTER TABLE `professores`
  ADD PRIMARY KEY (`id`),
  ADD UNIQUE KEY `cpf` (`cpf`),
  ADD UNIQUE KEY `email` (`email`);

--
-- Índices para tabela `professor_disciplina`
--
ALTER TABLE `professor_disciplina`
  ADD PRIMARY KEY (`professor_id`,`disciplina_id`),
  ADD KEY `disciplina_id` (`disciplina_id`);

--
-- AUTO_INCREMENT de tabelas despejadas
--

--
-- AUTO_INCREMENT de tabela `admins`
--
ALTER TABLE `admins`
  MODIFY `id` int(11) NOT NULL AUTO_INCREMENT, AUTO_INCREMENT=2;

--
-- AUTO_INCREMENT de tabela `alunos`
--
ALTER TABLE `alunos`
  MODIFY `id` int(11) NOT NULL AUTO_INCREMENT, AUTO_INCREMENT=9;

--
-- AUTO_INCREMENT de tabela `cursos`
--
ALTER TABLE `cursos`
  MODIFY `id` int(11) NOT NULL AUTO_INCREMENT, AUTO_INCREMENT=4;

--
-- AUTO_INCREMENT de tabela `disciplinas`
--
ALTER TABLE `disciplinas`
  MODIFY `id` int(11) NOT NULL AUTO_INCREMENT, AUTO_INCREMENT=5;

--
-- AUTO_INCREMENT de tabela `professores`
--
ALTER TABLE `professores`
  MODIFY `id` int(11) NOT NULL AUTO_INCREMENT, AUTO_INCREMENT=6;

--
-- Restrições para despejos de tabelas
--

--
-- Limitadores para a tabela `alunos`
--
ALTER TABLE `alunos`
  ADD CONSTRAINT `alunos_ibfk_1` FOREIGN KEY (`curso_id`) REFERENCES `cursos` (`id`);

--
-- Limitadores para a tabela `aluno_disciplina`
--
ALTER TABLE `aluno_disciplina`
  ADD CONSTRAINT `aluno_disciplina_ibfk_1` FOREIGN KEY (`aluno_id`) REFERENCES `alunos` (`id`),
  ADD CONSTRAINT `aluno_disciplina_ibfk_2` FOREIGN KEY (`disciplina_id`) REFERENCES `disciplinas` (`id`);

--
-- Limitadores para a tabela `curso_disciplina`
--
ALTER TABLE `curso_disciplina`
  ADD CONSTRAINT `curso_disciplina_ibfk_1` FOREIGN KEY (`curso_id`) REFERENCES `cursos` (`id`),
  ADD CONSTRAINT `curso_disciplina_ibfk_2` FOREIGN KEY (`disciplina_id`) REFERENCES `disciplinas` (`id`);

--
-- Limitadores para a tabela `disciplinas`
--
ALTER TABLE `disciplinas`
  ADD CONSTRAINT `disciplinas_ibfk_1` FOREIGN KEY (`pre_requisito_id`) REFERENCES `disciplinas` (`id`);

--
-- Limitadores para a tabela `professor_disciplina`
--
ALTER TABLE `professor_disciplina`
  ADD CONSTRAINT `professor_disciplina_ibfk_1` FOREIGN KEY (`disciplina_id`) REFERENCES `disciplinas` (`id`),
  ADD CONSTRAINT `professor_disciplina_ibfk_2` FOREIGN KEY (`professor_id`) REFERENCES `professores` (`id`);
COMMIT;

/*!40101 SET CHARACTER_SET_CLIENT=@OLD_CHARACTER_SET_CLIENT */;
/*!40101 SET CHARACTER_SET_RESULTS=@OLD_CHARACTER_SET_RESULTS */;
/*!40101 SET COLLATION_CONNECTION=@OLD_COLLATION_CONNECTION */;
